<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Interactive House Plan - Corrected Sizes</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 100vh;
            color: #333;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            padding: 15px 30px;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.1);
            z-index: 100;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: #333;
            margin-bottom: 5px;
            font-size: 28px;
        }

        .dimensions {
            color: #666;
            font-size: 16px;
        }

        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        #three-container {
            flex: 1;
            position: relative;
        }

        .controls {
            width: 320px;
            background: rgba(255, 255, 255, 0.95);
            padding: 20px;
            overflow-y: auto;
            box-shadow: -2px 0 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
        }

        .control-group {
            margin-bottom: 25px;
        }

        .control-group h3 {
            margin-bottom: 12px;
            color: #333;
            border-bottom: 1px solid #ddd;
            padding-bottom: 8px;
            font-size: 18px;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 15px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            margin-bottom: 10px;
            font-weight: bold;
            transition: all 0.3s ease;
            font-size: 14px;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .view-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .view-buttons button {
            margin-bottom: 0;
        }

        .room-info {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .room-info h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .room-info p {
            margin-bottom: 5px;
            font-size: 14px;
            display: flex;
            justify-content: space-between;
        }

        .room-info .label {
            font-weight: 600;
        }

        .legend {
            margin-top: 10px;
        }

        .legend-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #ddd;
            font-size: 14px;
        }

        .legend-item:last-child {
            border-bottom: none;
        }

        .legend-name {
            font-weight: 600;
        }

        .legend-area {
            color: #666;
        }

        .instructions {
            background: #fff3cd;
            padding: 15px;
            border-radius: 10px;
            margin-top: auto;
            font-size: 13px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.05);
        }

        .instructions h4 {
            margin-bottom: 10px;
            color: #856404;
            font-size: 14px;
        }

        .instructions ul {
            margin-left: 20px;
        }

        .instructions li {
            margin-bottom: 5px;
        }

        .mode-toggle {
            display: flex;
            background: #f0f0f0;
            border-radius: 8px;
            padding: 5px;
            margin-bottom: 15px;
        }

        .mode-toggle button {
            flex: 1;
            background: transparent;
            color: #666;
            padding: 8px;
            margin: 0;
        }

        .mode-toggle button.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }

        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }

            .controls {
                width: 100%;
                max-height: 40vh;
            }

            .header {
                flex-direction: column;
                text-align: center;
            }
        }

        /* Loading screen */
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            color: white;
            font-size: 24px;
            flex-direction: column;
        }

        .loading .spinner {
            border: 5px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 5px solid white;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }
    </style>
</head>

<body>
    <div class="loading" id="loading">
        <div class="spinner"></div>
        <div>Building Your 3D House...</div>
    </div>

    <div class="header">
        <div>
            <h1>üè† 3D Interactive House Plan</h1>
            <div class="dimensions">30√ó27 ft with 7√ó5 ft washroom</div>
        </div>
        <div class="stats" id="stats">
            <div>Rooms: 6</div>
            <div>Total Area: 702 sq ft</div>
        </div>
    </div>

    <div class="container">
        <div id="three-container"></div>

        <div class="controls">
            <div class="mode-toggle">
                <button id="mode-walk" class="active">Walk Mode</button>
                <button id="mode-orbit">Orbit Mode</button>
            </div>

            <div class="control-group">
                <h3>Navigation</h3>
                <button id="reset-view">Reset View</button>
                <div class="view-buttons">
                    <button id="toggle-walls">Toggle Walls</button>
                    <button id="toggle-roof">Toggle Roof</button>
                </div>
                <button id="day-night">Toggle Day/Night</button>
            </div>

            <div class="control-group">
                <h3>Room Views</h3>
                <div class="view-buttons">
                    <button id="view-room1">Room 1</button>
                    <button id="view-room2">Room 2</button>
                    <button id="view-room3">Room 3</button>
                    <button id="view-hall">Hall</button>
                    <button id="view-washroom">Washroom</button>
                    <button id="view-porch">Porch</button>
                </div>
            </div>

            <div class="room-info">
                <h4>House Information</h4>
                <p><span class="label">Total Area:</span> <span>702 sq ft</span></p>
                <p><span class="label">Dimensions:</span> <span>30√ó27 ft</span></p>
                <p><span class="label">Rooms:</span> <span>3 Bedrooms, Hall, Washroom, Porch</span></p>
                <p><span class="label">Status:</span> <span id="room-status">Exploring</span></p>
            </div>

            <div class="legend">
                <h3>Room Details</h3>
                <div class="legend-item">
                    <span class="legend-name">Room 1</span>
                    <span class="legend-area">11√ó13 ft (143 sq ft)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-name">Room 2</span>
                    <span class="legend-area">11√ó13 ft (143 sq ft)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-name">Washroom</span>
                    <span class="legend-area">7√ó5 ft (35 sq ft)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-name">Room 3</span>
                    <span class="legend-area">11√ó13 ft (143 sq ft)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-name">Hall</span>
                    <span class="legend-area">11√ó13 ft (143 sq ft)</span>
                </div>
                <div class="legend-item">
                    <span class="legend-name">Porch</span>
                    <span class="legend-area">5√ó19 ft (95 sq ft)</span>
                </div>
            </div>

            <div class="instructions">
                <h4>Navigation Instructions</h4>
                <ul>
                    <li><strong>Walk Mode:</strong> Use W,A,S,D keys to move, mouse to look around</li>
                    <li><strong>Orbit Mode:</strong> Click and drag to rotate, scroll to zoom</li>
                    <li><strong>Room Views:</strong> Click buttons to teleport to specific rooms</li>
                    <li><strong>Toggle Controls:</strong> Show/hide walls and roof for different views</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- Three.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- OrbitControls for camera control -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <!-- PointerLockControls for first-person navigation -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/PointerLockControls.js"></script>

    <script>
        // Initialize Three.js scene
        let scene, camera, renderer, controls, pointerControls;
        let wallsVisible = true;
        let roofVisible = true;
        let isDay = true;
        let currentMode = 'walk';

        // Room dimensions (in feet, converted to meters for Three.js)
        const ftToMeter = 0.3048;
        const wallHeight = 10 * ftToMeter; // 10 ft high walls

        // Room dimensions in feet (from your floor plan)
        const room1Size = { width: 11, depth: 13 };
        const room2Size = { width: 11, depth: 13 };
        const room3Size = { width: 11, depth: 13 };
        const washroomSize = { width: 7, depth: 5 };
        const hallSize = { width: 11, depth: 13 };
        const porchSize = { width: 5, depth: 19 };

        // House layout positions (from your 2D plan, converted to feet)
        // The 2D plan uses pixels, but we need to convert to feet based on the total dimensions
        const totalWidthFt = 30;
        const totalDepthFt = 27;

        // Calculate positions in feet based on your 2D plan layout
        // In your 2D plan, the house is 700px wide and 707px deep
        // So we'll convert pixel positions to feet
        const pxToFtWidth = totalWidthFt / 700;
        const pxToFtDepth = totalDepthFt / 707;

        // Room positions in feet (calculated from your 2D plan)
        const room1Pos = {
            x: 128 * pxToFtWidth,
            z: 0 * pxToFtDepth
        };
        const room2Pos = {
            x: 414 * pxToFtWidth,
            z: 0 * pxToFtDepth
        };
        const washroomPos = {
            x: 128 * pxToFtWidth,
            z: 286 * pxToFtDepth
        };
        const room3Pos = {
            x: 128 * pxToFtWidth,
            z: 421 * pxToFtDepth
        };
        const hallPos = {
            x: 414 * pxToFtWidth,
            z: 286 * pxToFtDepth
        };
        const porchPos = {
            x: 414 * pxToFtWidth,
            z: 572 * pxToFtDepth
        };

        // Room materials with different colors
        const roomMaterials = {
            room1: new THREE.MeshLambertMaterial({ color: 0x74b9ff }),
            room2: new THREE.MeshLambertMaterial({ color: 0x81ecec }),
            room3: new THREE.MeshLambertMaterial({ color: 0xfab1a0 }),
            hall: new THREE.MeshLambertMaterial({ color: 0xffeaa7 }),
            washroom: new THREE.MeshLambertMaterial({ color: 0xdfe6e9 }),
            porch: new THREE.MeshLambertMaterial({ color: 0xa29bfe }),
            floor: new THREE.MeshLambertMaterial({ color: 0xcccccc }),
            roof: new THREE.MeshLambertMaterial({ color: 0x8B4513 })
        };

        // Store room objects for interaction
        const rooms = {};

        // Movement variables for first-person mode
        let moveForward = false;
        let moveBackward = false;
        let moveLeft = false;
        let moveRight = false;
        let prevTime = performance.now();
        const velocity = new THREE.Vector3();
        const direction = new THREE.Vector3();

        function init() {
            // Create scene
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x87CEEB); // Sky blue

            // Create camera
            camera = new THREE.PerspectiveCamera(75, (window.innerWidth - 320) / (window.innerHeight - 100), 0.1, 1000);
            camera.position.set(0, 5, 10);

            // Create renderer
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth - 320, window.innerHeight - 100);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('three-container').appendChild(renderer.domElement);

            // Add orbit controls
            controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;

            // Add pointer lock controls for first-person navigation
            pointerControls = new THREE.PointerLockControls(camera, document.body);

            // Set up lighting
            setupLighting();

            // Create house
            createHouse();

            // Add grid helper
            const gridHelper = new THREE.GridHelper(20, 20, 0x000000, 0x000000);
            gridHelper.position.y = -0.01;
            scene.add(gridHelper);

            // Handle window resize
            window.addEventListener('resize', onWindowResize);

            // Add event listeners for buttons
            setupEventListeners();

            // Set up first-person controls
            setupFirstPersonControls();

            // Hide loading screen
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
            }, 1500);

            // Start animation loop
            animate();
        }

        function setupLighting() {
            // Ambient light
            const ambientLight = new THREE.AmbientLight(0x404040, 0.6);
            scene.add(ambientLight);

            // Directional light (sun)
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(10, 20, 10);
            directionalLight.castShadow = true;
            directionalLight.shadow.mapSize.width = 2048;
            directionalLight.shadow.mapSize.height = 2048;
            directionalLight.shadow.camera.near = 0.5;
            directionalLight.shadow.camera.far = 50;
            directionalLight.shadow.camera.left = -20;
            directionalLight.shadow.camera.right = 20;
            directionalLight.shadow.camera.top = 20;
            directionalLight.shadow.camera.bottom = -20;
            scene.add(directionalLight);

            // Hemisphere light for more natural outdoor lighting
            const hemisphereLight = new THREE.HemisphereLight(0x87CEEB, 0x8B4513, 0.3);
            scene.add(hemisphereLight);
        }

        function createHouse() {
            // Floor
            const floorGeometry = new THREE.PlaneGeometry(totalWidthFt * ftToMeter, totalDepthFt * ftToMeter);
            const floor = new THREE.Mesh(floorGeometry, roomMaterials.floor);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Create walls
            createWalls();

            // Create roof
            createRoof();

            // Add some basic furniture to make it more realistic
            addFurniture();
        }

        function createWalls() {
            // Room 1 walls
            rooms.room1 = createRoomWalls(room1Pos, room1Size, roomMaterials.room1, 'room1');

            // Room 2 walls
            rooms.room2 = createRoomWalls(room2Pos, room2Size, roomMaterials.room2, 'room2');

            // Washroom walls
            rooms.washroom = createRoomWalls(washroomPos, washroomSize, roomMaterials.washroom, 'washroom');

            // Room 3 walls
            rooms.room3 = createRoomWalls(room3Pos, room3Size, roomMaterials.room3, 'room3');

            // Hall walls
            rooms.hall = createRoomWalls(hallPos, hallSize, roomMaterials.hall, 'hall');

            // Porch walls (only two walls)
            rooms.porch = createPorchWalls(porchPos, porchSize, roomMaterials.porch);
        }

        function createRoomWalls(position, size, material, roomName) {
            const x = position.x * ftToMeter - (totalWidthFt * ftToMeter) / 2;
            const z = position.z * ftToMeter - (totalDepthFt * ftToMeter) / 2;
            const width = size.width * ftToMeter;
            const depth = size.depth * ftToMeter;

            const wallGroup = new THREE.Group();
            wallGroup.userData = { room: roomName, type: 'walls' };

            // Create walls for the room
            const wallThickness = 0.1;

            // Front wall
            const frontWallGeometry = new THREE.BoxGeometry(width, wallHeight, wallThickness);
            const frontWall = new THREE.Mesh(frontWallGeometry, material);
            frontWall.position.set(x + width / 2, wallHeight / 2, z);
            frontWall.castShadow = true;
            frontWall.receiveShadow = true;
            wallGroup.add(frontWall);

            // Back wall
            const backWallGeometry = new THREE.BoxGeometry(width, wallHeight, wallThickness);
            const backWall = new THREE.Mesh(backWallGeometry, material);
            backWall.position.set(x + width / 2, wallHeight / 2, z + depth);
            backWall.castShadow = true;
            backWall.receiveShadow = true;
            wallGroup.add(backWall);

            // Left wall
            const leftWallGeometry = new THREE.BoxGeometry(wallThickness, wallHeight, depth);
            const leftWall = new THREE.Mesh(leftWallGeometry, material);
            leftWall.position.set(x, wallHeight / 2, z + depth / 2);
            leftWall.castShadow = true;
            leftWall.receiveShadow = true;
            wallGroup.add(leftWall);

            // Right wall
            const rightWallGeometry = new THREE.BoxGeometry(wallThickness, wallHeight, depth);
            const rightWall = new THREE.Mesh(rightWallGeometry, material);
            rightWall.position.set(x + width, wallHeight / 2, z + depth / 2);
            rightWall.castShadow = true;
            rightWall.receiveShadow = true;
            wallGroup.add(rightWall);

            scene.add(wallGroup);
            return wallGroup;
        }

        function createPorchWalls(position, size, material) {
            const x = position.x * ftToMeter - (totalWidthFt * ftToMeter) / 2;
            const z = position.z * ftToMeter - (totalDepthFt * ftToMeter) / 2;
            const width = size.width * ftToMeter;
            const depth = size.depth * ftToMeter;

            const wallGroup = new THREE.Group();
            wallGroup.userData = { room: 'porch', type: 'walls' };

            const wallThickness = 0.1;

            // Front wall
            const frontWallGeometry = new THREE.BoxGeometry(width, wallHeight, wallThickness);
            const frontWall = new THREE.Mesh(frontWallGeometry, material);
            frontWall.position.set(x + width / 2, wallHeight / 2, z);
            frontWall.castShadow = true;
            frontWall.receiveShadow = true;
            wallGroup.add(frontWall);

            // Left wall (only partial)
            const leftWallGeometry = new THREE.BoxGeometry(wallThickness, wallHeight, depth / 2);
            const leftWall = new THREE.Mesh(leftWallGeometry, material);
            leftWall.position.set(x, wallHeight / 2, z + depth / 4);
            leftWall.castShadow = true;
            leftWall.receiveShadow = true;
            wallGroup.add(leftWall);

            scene.add(wallGroup);
            return wallGroup;
        }

        function createRoof() {
            // Create a simple flat roof for the entire house
            const roofGeometry = new THREE.PlaneGeometry(totalWidthFt * ftToMeter, totalDepthFt * ftToMeter);
            const roof = new THREE.Mesh(roofGeometry, roomMaterials.roof);
            roof.rotation.x = -Math.PI / 2;
            roof.position.y = wallHeight;
            roof.receiveShadow = true;
            roof.userData = { type: 'roof' };
            scene.add(roof);
        }

        function addFurniture() {
            // Add some basic furniture to make the house more realistic
            // This is a simplified version - you can expand this with more detailed models

            // Add a bed to room 1
            const bedGeometry = new THREE.BoxGeometry(2 * ftToMeter, 0.5 * ftToMeter, 1 * ftToMeter);
            const bedMaterial = new THREE.MeshLambertMaterial({ color: 0x8B4513 });
            const bed = new THREE.Mesh(bedGeometry, bedMaterial);
            bed.position.set(
                room1Pos.x * ftToMeter - (totalWidthFt * ftToMeter) / 2 + (room1Size.width * ftToMeter * 0.7),
                0.25 * ftToMeter,
                room1Pos.z * ftToMeter - (totalDepthFt * ftToMeter) / 2 + (room1Size.depth * ftToMeter * 0.3)
            );
            bed.castShadow = true;
            scene.add(bed);

            // Add a table to the hall
            const tableGeometry = new THREE.BoxGeometry(1.5 * ftToMeter, 0.8 * ftToMeter, 1.5 * ftToMeter);
            const tableMaterial = new THREE.MeshLambertMaterial({ color: 0xDEB887 });
            const table = new THREE.Mesh(tableGeometry, tableMaterial);
            table.position.set(
                hallPos.x * ftToMeter - (totalWidthFt * ftToMeter) / 2 + (hallSize.width * ftToMeter * 0.5),
                0.4 * ftToMeter,
                hallPos.z * ftToMeter - (totalDepthFt * ftToMeter) / 2 + (hallSize.depth * ftToMeter * 0.5)
            );
            table.castShadow = true;
            scene.add(table);

            // Add a toilet to the washroom
            const toiletGeometry = new THREE.BoxGeometry(0.7 * ftToMeter, 0.4 * ftToMeter, 0.5 * ftToMeter);
            const toiletMaterial = new THREE.MeshLambertMaterial({ color: 0xFFFFFF });
            const toilet = new THREE.Mesh(toiletGeometry, toiletMaterial);
            toilet.position.set(
                washroomPos.x * ftToMeter - (totalWidthFt * ftToMeter) / 2 + (washroomSize.width * ftToMeter * 0.3),
                0.2 * ftToMeter,
                washroomPos.z * ftToMeter - (totalDepthFt * ftToMeter) / 2 + (washroomSize.depth * ftToMeter * 0.7)
            );
            toilet.castShadow = true;
            scene.add(toilet);
        }

        function setupEventListeners() {
            // Navigation buttons
            document.getElementById('reset-view').addEventListener('click', resetView);
            document.getElementById('toggle-walls').addEventListener('click', toggleWalls);
            document.getElementById('toggle-roof').addEventListener('click', toggleRoof);
            document.getElementById('day-night').addEventListener('click', toggleDayNight);

            // Room view buttons
            document.getElementById('view-room1').addEventListener('click', () => focusOnRoom('room1'));
            document.getElementById('view-room2').addEventListener('click', () => focusOnRoom('room2'));
            document.getElementById('view-room3').addEventListener('click', () => focusOnRoom('room3'));
            document.getElementById('view-hall').addEventListener('click', () => focusOnRoom('hall'));
            document.getElementById('view-washroom').addEventListener('click', () => focusOnRoom('washroom'));
            document.getElementById('view-porch').addEventListener('click', () => focusOnRoom('porch'));

            // Mode toggle buttons
            document.getElementById('mode-walk').addEventListener('click', () => switchMode('walk'));
            document.getElementById('mode-orbit').addEventListener('click', () => switchMode('orbit'));
        }

        function setupFirstPersonControls() {
            // Keyboard controls for first-person movement
            document.addEventListener('keydown', onKeyDown);
            document.addEventListener('keyup', onKeyUp);

            // Pointer lock change event
            document.addEventListener('pointerlockchange', onPointerLockChange);
        }

        function onKeyDown(event) {
            if (currentMode !== 'walk') return;

            switch (event.code) {
                case 'ArrowUp':
                case 'KeyW':
                    moveForward = true;
                    break;
                case 'ArrowLeft':
                case 'KeyA':
                    moveLeft = true;
                    break;
                case 'ArrowDown':
                case 'KeyS':
                    moveBackward = true;
                    break;
                case 'ArrowRight':
                case 'KeyD':
                    moveRight = true;
                    break;
            }
        }

        function onKeyUp(event) {
            if (currentMode !== 'walk') return;

            switch (event.code) {
                case 'ArrowUp':
                case 'KeyW':
                    moveForward = false;
                    break;
                case 'ArrowLeft':
                case 'KeyA':
                    moveLeft = false;
                    break;
                case 'ArrowDown':
                case 'KeyS':
                    moveBackward = false;
                    break;
                case 'ArrowRight':
                case 'KeyD':
                    moveRight = false;
                    break;
            }
        }

        function onPointerLockChange() {
            if (document.pointerLockElement === document.body) {
                pointerControls.lock();
            } else {
                pointerControls.unlock();
            }
        }

        function switchMode(mode) {
            currentMode = mode;

            // Update UI
            document.getElementById('mode-walk').classList.toggle('active', mode === 'walk');
            document.getElementById('mode-orbit').classList.toggle('active', mode === 'orbit');

            if (mode === 'walk') {
                controls.enabled = false;
                pointerControls.lock();
                document.body.requestPointerLock();
            } else {
                pointerControls.unlock();
                document.exitPointerLock();
                controls.enabled = true;
            }
        }

        function toggleWalls() {
            wallsVisible = !wallsVisible;
            scene.traverse(function (object) {
                if (object.userData.type === 'walls') {
                    object.visible = wallsVisible;
                }
            });
        }

        function toggleRoof() {
            roofVisible = !roofVisible;
            scene.traverse(function (object) {
                if (object.userData.type === 'roof') {
                    object.visible = roofVisible;
                }
            });
        }

        function toggleDayNight() {
            isDay = !isDay;
            if (isDay) {
                scene.background = new THREE.Color(0x87CEEB); // Sky blue
                scene.traverse(function (object) {
                    if (object.isLight && object.type === 'AmbientLight') {
                        object.intensity = 0.6;
                    }
                });
            } else {
                scene.background = new THREE.Color(0x0a0a2a); // Dark blue
                scene.traverse(function (object) {
                    if (object.isLight && object.type === 'AmbientLight') {
                        object.intensity = 0.2;
                    }
                });
            }
        }

        function focusOnRoom(roomName) {
            // Define camera positions for each room
            const roomViews = {
                room1: {
                    position: new THREE.Vector3(
                        (room1Pos.x + room1Size.width / 2) * ftToMeter - (totalWidthFt * ftToMeter) / 2,
                        1.6,
                        (room1Pos.z + room1Size.depth / 2) * ftToMeter - (totalDepthFt * ftToMeter) / 2
                    )
                },
                room2: {
                    position: new THREE.Vector3(
                        (room2Pos.x + room2Size.width / 2) * ftToMeter - (totalWidthFt * ftToMeter) / 2,
                        1.6,
                        (room2Pos.z + room2Size.depth / 2) * ftToMeter - (totalDepthFt * ftToMeter) / 2
                    )
                },
                room3: {
                    position: new THREE.Vector3(
                        (room3Pos.x + room3Size.width / 2) * ftToMeter - (totalWidthFt * ftToMeter) / 2,
                        1.6,
                        (room3Pos.z + room3Size.depth / 2) * ftToMeter - (totalDepthFt * ftToMeter) / 2
                    )
                },
                hall: {
                    position: new THREE.Vector3(
                        (hallPos.x + hallSize.width / 2) * ftToMeter - (totalWidthFt * ftToMeter) / 2,
                        1.6,
                        (hallPos.z + hallSize.depth / 2) * ftToMeter - (totalDepthFt * ftToMeter) / 2
                    )
                },
                washroom: {
                    position: new THREE.Vector3(
                        (washroomPos.x + washroomSize.width / 2) * ftToMeter - (totalWidthFt * ftToMeter) / 2,
                        1.6,
                        (washroomPos.z + washroomSize.depth / 2) * ftToMeter - (totalDepthFt * ftToMeter) / 2
                    )
                },
                porch: {
                    position: new THREE.Vector3(
                        (porchPos.x + porchSize.width / 2) * ftToMeter - (totalWidthFt * ftToMeter) / 2,
                        1.6,
                        (porchPos.z + porchSize.depth / 2) * ftToMeter - (totalDepthFt * ftToMeter) / 2
                    )
                }
            };

            if (roomViews[roomName]) {
                const view = roomViews[roomName];
                camera.position.copy(view.position);

                if (currentMode === 'orbit') {
                    controls.target.copy(view.position);
                    controls.update();
                }

                // Update room status
                document.getElementById('room-status').textContent = `In ${roomName.toUpperCase()}`;
            }
        }

        function resetView() {
            if (currentMode === 'orbit') {
                camera.position.set(0, 15, 15);
                controls.target.set(0, 0, 0);
                controls.update();
            } else {
                camera.position.set(0, 1.6, 10);
            }
            document.getElementById('room-status').textContent = 'Exploring';
        }

        function onWindowResize() {
            camera.aspect = (window.innerWidth - 320) / (window.innerHeight - 100);
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth - 320, window.innerHeight - 100);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (currentMode === 'walk') {
                // First-person movement
                const time = performance.now();
                const delta = (time - prevTime) / 1000;

                velocity.x -= velocity.x * 10.0 * delta;
                velocity.z -= velocity.z * 10.0 * delta;

                direction.z = Number(moveForward) - Number(moveBackward);
                direction.x = Number(moveRight) - Number(moveLeft);
                direction.normalize();

                if (moveForward || moveBackward) velocity.z -= direction.z * 10.0 * delta;
                if (moveLeft || moveRight) velocity.x -= direction.x * 10.0 * delta;

                pointerControls.moveRight(-velocity.x * delta);
                pointerControls.moveForward(-velocity.z * delta);

                prevTime = time;
            } else {
                // Orbit controls update
                controls.update();
            }

            renderer.render(scene, camera);
        }

        // Initialize the 3D scene
        init();
    </script>
</body>

</html>