<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Interactive Floor Plan</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            overflow: hidden;
            background: #000;
        }

        #container {
            width: 100vw;
            height: 100vh;
        }

        .ui-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }



        .nav-buttons {
            position: absolute;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            pointer-events: auto;
            z-index: 11;
        }

        .nav-btn {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            border: none;
            cursor: pointer;
            font-size: 24px;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
        }

        .nav-btn:hover {
            transform: scale(1.1);
            box-shadow: 0 8px 30px rgba(102, 126, 234, 0.5);
        }

        .title {
            position: absolute;
            top: 40px;
            left: 50%;
            transform: translateX(-50%);
            color: white;
            font-size: 36px;
            font-weight: bold;
            text-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
            pointer-events: none;
        }

        .instructions {
            position: absolute;
            top: 100px;
            left: 50%;
            transform: translateX(-50%);
            color: rgba(255, 255, 255, 0.8);
            font-size: 16px;
            text-align: center;
            pointer-events: none;
            animation: fadeInOut 3s infinite;
        }

        @keyframes fadeInOut {

            0%,
            100% {
                opacity: 0.5;
            }

            50% {
                opacity: 1;
            }
        }

        .room-list {
            position: absolute;
            top: 30px;
            right: 30px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            pointer-events: auto;
            max-width: 250px;
        }

        .room-list h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        .room-item {
            padding: 12px;
            margin: 8px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: 600;
        }

        .room-item:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .view-controls {
            position: absolute;
            top: 30px;
            left: 30px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            pointer-events: auto;
            max-width: 250px;
            z-index: 10;
        }

        .view-controls h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        .toggle-btn {
            padding: 10px;
            margin: 6px 0;
            background: #f0f0f0;
            color: #333;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 13px;
            font-weight: 600;
            width: 100%;
            text-align: left;
        }

        .toggle-btn:hover {
            background: #e0e0e0;
            border-color: #667eea;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }

        .loading {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 24px;
            pointer-events: none;
        }

        .room-info {
            position: absolute;
            bottom: 200px;
            right: 30px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            pointer-events: auto;
            max-width: 280px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.4s ease;
            z-index: 6;
        }

        .room-info.visible {
            opacity: 1;
            transform: translateY(0);
        }

        .room-info h3 {
            color: #333;
            font-size: 20px;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .room-info .room-details {
            color: #666;
            font-size: 14px;
            line-height: 1.6;
        }

        .room-info .room-area {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 12px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 10px;
            display: inline-block;
        }

        .minimap {
            position: absolute;
            bottom: 30px;
            right: 280px;
            width: 200px;
            height: 150px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            pointer-events: auto;
            padding: 15px;
            z-index: 7;
        }

        .minimap h4 {
            color: #333;
            font-size: 14px;
            margin-bottom: 10px;
            text-align: center;
        }

        .minimap-grid {
            width: 100%;
            height: 100px;
            background: #f0f0f0;
            border-radius: 8px;
            position: relative;
            overflow: hidden;
        }

        .minimap-room {
            position: absolute;
            border: 1px solid #fff;
            border-radius: 2px;
            font-size: 8px;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .minimap-room:hover {
            transform: scale(1.1);
            z-index: 10;
        }

        .stats-panel {
            position: absolute;
            top: 280px;
            left: 30px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            pointer-events: auto;
            max-width: 250px;
            z-index: 9;
        }

        .stats-panel h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        .stat-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            font-size: 14px;
        }

        .stat-item:last-child {
            border-bottom: none;
        }

        .stat-label {
            color: #666;
        }

        .stat-value {
            color: #333;
            font-weight: bold;
        }

        .lighting-controls {
            position: absolute;
            top: 450px;
            left: 30px;
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            pointer-events: auto;
            max-width: 250px;
            z-index: 8;
        }

        .lighting-controls h3 {
            margin-bottom: 15px;
            color: #333;
            font-size: 18px;
        }

        .slider-container {
            margin: 15px 0;
        }

        .slider-label {
            color: #666;
            font-size: 13px;
            margin-bottom: 5px;
        }

        .slider {
            width: 100%;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            cursor: pointer;
        }

        .time-controls {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .time-btn {
            flex: 1;
            padding: 8px;
            background: #f0f0f0;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .time-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
    </style>
</head>

<body>
    <div id="container"></div>

    <div class="ui-overlay">
        <div class="title">üè† Your Dream Home in 3D</div>
        <div class="instructions">Drag to rotate ‚Ä¢ Scroll to zoom ‚Ä¢ Explore the architecture</div>

        <div class="view-controls">
            <h3>üé® View Options</h3>
            <button class="toggle-btn active" id="btnRooms" onclick="toggleRooms()">‚úÖ Show Rooms</button>
            <button class="toggle-btn active" id="btnOuterWalls" onclick="toggleOuterWalls()">‚úÖ Outer Walls</button>
            <button class="toggle-btn active" id="btnInnerWalls" onclick="toggleInnerWalls()">‚úÖ Inner Walls</button>
            <button class="toggle-btn active" id="btnDoors" onclick="toggleDoors()">‚úÖ Doors</button>
            <button class="toggle-btn active" id="btnWindows" onclick="toggleWindows()">‚úÖ Windows</button>
            <button class="toggle-btn active" id="btnGate" onclick="toggleGate()">‚úÖ Gate</button>
            <button class="toggle-btn active" id="btnRoof" onclick="toggleRoof()">‚úÖ Roof</button>
        </div>

        <div class="room-list">
            <h3>üìç Focus Room</h3>
            <div class="room-item" onclick="focusRoom(0)">üõèÔ∏è Room 1</div>
            <div class="room-item" onclick="focusRoom(1)">üõèÔ∏è Room 2</div>
            <div class="room-item" onclick="focusRoom(2)">üöø Washroom</div>
            <div class="room-item" onclick="focusRoom(3)">üõèÔ∏è Room 3</div>
            <div class="room-item" onclick="focusRoom(4)">üõãÔ∏è Hall</div>
            <div class="room-item" onclick="focusRoom(5)">üö™ Porch</div>
        </div>



        <div class="room-info" id="roomInfo">
            <h3 id="roomTitle">üè† Select a room</h3>
            <div class="room-details" id="roomDetails">
                Click on a room or use the room list to explore your home
            </div>
            <div class="room-area" id="roomArea" style="display: none;">Area: 0 sq ft</div>
        </div>

        <div class="stats-panel">
            <h3>üìä House Stats</h3>
            <div class="stat-item">
                <span class="stat-label">Total Rooms:</span>
                <span class="stat-value">6</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Total Area:</span>
                <span class="stat-value">702 sq ft</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Bedrooms:</span>
                <span class="stat-value">3</span>
            </div>
            <div class="stat-item">
                <span class="stat-label">Bathrooms:</span>
                <span class="stat-value">1</span>
            </div>
        </div>

        <div class="lighting-controls">
            <h3>üí° Lighting</h3>
            <div class="slider-container">
                <div class="slider-label">Ambient Light</div>
                <input type="range" min="0" max="100" value="40" class="slider" id="ambientSlider">
            </div>
            <div class="slider-container">
                <div class="slider-label">Main Light</div>
                <input type="range" min="0" max="100" value="80" class="slider" id="mainSlider">
            </div>
            <div class="time-controls">
                <button class="time-btn" onclick="setTimeOfDay('morning')">üåÖ Morning</button>
                <button class="time-btn active" onclick="setTimeOfDay('day')">‚òÄÔ∏è Day</button>
                <button class="time-btn" onclick="setTimeOfDay('evening')">üåÜ Evening</button>
                <button class="time-btn" onclick="setTimeOfDay('night')">üåô Night</button>
            </div>
        </div>

        <div class="minimap">
            <h4>üó∫Ô∏è Floor Plan</h4>
            <div class="minimap-grid" id="minimapGrid"></div>
        </div>

        <div class="nav-buttons">
            <button class="nav-btn" onclick="toggleView()" title="Toggle View">üëÅÔ∏è</button>
            <button class="nav-btn" onclick="resetView()" title="Reset">üîÑ</button>
            <button class="nav-btn" onclick="takeScreenshot()" title="Screenshot">üì∏</button>
            <button class="nav-btn" onclick="toggleFullscreen()" title="Fullscreen">‚õ∂</button>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script>
        let scene, camera, renderer;
        let roomMeshes = [];
        let roomBoxes = []; // Store only the main room boxes for animation
        let outerWallMeshes = [];
        let innerWallMeshes = [];
        let doorMeshes = [];
        let windowMeshes = [];
        let gateMeshes = [];
        let roofMesh = null;
        let selectedRoom = null;
        let isDragging = false;
        let previousMouse = { x: 0, y: 0 };
        let rotation = { x: 0.5, y: 0 };
        let targetRotation = { x: 0.5, y: 0 };
        let cameraDistance = 60;
        let targetCameraDistance = 60;
        let autoRotate = true;

        // Enhanced lighting variables
        let ambientLight, mainLight, fillLight, rimLight;
        let currentTimeOfDay = 'day';
        
        // Interaction variables
        let raycaster = new THREE.Raycaster();
        let mouse = new THREE.Vector2();
        let hoveredRoom = null;

        let showRooms = true;
        let showOuterWalls = true;
        let showInnerWalls = true;
        let showDoors = true;
        let showWindows = true;
        let showGate = true;
        let showRoof = true;

        const roomData = [
            { name: 'Room 1', x: 6.5, z: 6.5, w: 13, d: 13, color: 0x4A90E2, area: '143 sq ft', desc: 'Bedroom' },
            { name: 'Room 2', x: 19.5, z: 6.5, w: 13, d: 13, color: 0x50C878, area: '143 sq ft', desc: 'Bedroom' },
            { name: 'Washroom', x: 3.5, z: 16, w: 7, d: 5, color: 0x9B9B9B, area: '35 sq ft', desc: 'Bathroom' },
            { name: 'Room 3', x: 6.5, z: 23, w: 13, d: 13, color: 0xE74C3C, area: '143 sq ft', desc: 'Bedroom' },
            { name: 'Hall', x: 19.5, z: 19.5, w: 13, d: 13, color: 0xF39C12, area: '143 sq ft', desc: 'Living Room' },
            { name: 'Porch', x: 19.5, z: 28.5, w: 13, d: 5, color: 0x9B59B6, area: '95 sq ft', desc: 'Entrance' }
        ];

        init();
        animate();

        function init() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x1a1a2e);
            scene.fog = new THREE.Fog(0x1a1a2e, 50, 100);

            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            updateCameraPosition();

            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap;
            document.getElementById('container').appendChild(renderer.domElement);

            // Enhanced Lighting System
            ambientLight = new THREE.AmbientLight(0xffffff, 0.4);
            scene.add(ambientLight);

            mainLight = new THREE.DirectionalLight(0xffffff, 0.8);
            mainLight.position.set(30, 50, 30);
            mainLight.castShadow = true;
            mainLight.shadow.mapSize.width = 4096;
            mainLight.shadow.mapSize.height = 4096;
            mainLight.shadow.camera.near = 0.1;
            mainLight.shadow.camera.far = 200;
            mainLight.shadow.camera.left = -50;
            mainLight.shadow.camera.right = 50;
            mainLight.shadow.camera.top = 50;
            mainLight.shadow.camera.bottom = -50;
            scene.add(mainLight);

            fillLight = new THREE.DirectionalLight(0x667eea, 0.3);
            fillLight.position.set(-30, 20, -30);
            scene.add(fillLight);

            rimLight = new THREE.DirectionalLight(0x764ba2, 0.3);
            rimLight.position.set(0, 20, -50);
            scene.add(rimLight);

            // Add point lights for rooms
            addRoomLighting();

            // Create enhanced floor with texture-like pattern
            const floorGeometry = new THREE.PlaneGeometry(100, 100);
            const floorMaterial = new THREE.MeshStandardMaterial({
                color: 0x1a1a2e,
                roughness: 0.9,
                metalness: 0.1
            });
            const floor = new THREE.Mesh(floorGeometry, floorMaterial);
            floor.rotation.x = -Math.PI / 2;
            floor.receiveShadow = true;
            scene.add(floor);

            // Add subtle grid pattern to floor
            const gridHelper = new THREE.GridHelper(100, 50, 0x2a2a3e, 0x2a2a3e);
            gridHelper.position.y = 0.01;
            scene.add(gridHelper);

            // Create rooms
            roomData.forEach((room, index) => {
                createRoom(room, index);
            });

            // Create roof
            createRoof();

            // Create walls
            createWalls();

            // Create doors
            createDoors();

            // Create windows
            createWindows();

            // Create gate/entrance
            createGate();

            // Mouse controls
            setupControls();

            // Initialize UI
            initializeMinimap();
            initializeLightingControls();
            showRoomInfo();

            window.addEventListener('resize', onResize);
        }

        function createRoom(room, index) {
            const geometry = new THREE.BoxGeometry(room.w, 4, room.d);
            const material = new THREE.MeshStandardMaterial({
                color: room.color,
                roughness: 0.3,
                metalness: 0.6,
                emissive: room.color,
                emissiveIntensity: 0.2
            });

            const mesh = new THREE.Mesh(geometry, material);
            mesh.position.set(room.x, 2, room.z);
            mesh.castShadow = true;
            mesh.receiveShadow = true;
            mesh.userData = { index, ...room };

            roomMeshes.push(mesh);
            roomBoxes.push(mesh); // Store for animation
            scene.add(mesh);

            // Add edge glow
            const edges = new THREE.EdgesGeometry(geometry);
            const lineMaterial = new THREE.LineBasicMaterial({ color: 0xffffff, linewidth: 2 });
            const wireframe = new THREE.LineSegments(edges, lineMaterial);
            mesh.add(wireframe);

            // Add furniture
            addFurniture(room, index);
        }

        function addFurniture(room, index) {
            const woodMaterial = new THREE.MeshStandardMaterial({ color: 0x8B4513, roughness: 0.7 });
            const whiteMaterial = new THREE.MeshStandardMaterial({ color: 0xFFFFFF, roughness: 0.5 });
            const metalMaterial = new THREE.MeshStandardMaterial({ color: 0xC0C0C0, roughness: 0.3, metalness: 0.8 });
            const fabricMaterial = new THREE.MeshStandardMaterial({ color: 0x4A4A4A, roughness: 0.9 });

            if (room.name === 'Room 1' || room.name === 'Room 2' || room.name === 'Room 3') {
                // Bed frame
                const bedFrameGeo = new THREE.BoxGeometry(6, 0.5, 4);
                const bedFrame = new THREE.Mesh(bedFrameGeo, woodMaterial);
                bedFrame.position.set(room.x - 2.5, 0.5, room.z - 3);
                bedFrame.castShadow = true;
                roomMeshes.push(bedFrame);
                scene.add(bedFrame);

                // Mattress
                const mattressGeo = new THREE.BoxGeometry(5.8, 0.8, 3.8);
                const mattress = new THREE.Mesh(mattressGeo, fabricMaterial);
                mattress.position.set(room.x - 2.5, 1.2, room.z - 3);
                mattress.castShadow = true;
                roomMeshes.push(mattress);
                scene.add(mattress);

                // Pillow
                const pillowGeo = new THREE.BoxGeometry(1.5, 0.3, 1);
                const pillow = new THREE.Mesh(pillowGeo, whiteMaterial);
                pillow.position.set(room.x - 2.5, 1.7, room.z - 4.5);
                roomMeshes.push(pillow);
                scene.add(pillow);

                // Wardrobe
                const wardrobeGeo = new THREE.BoxGeometry(3, 4, 1.5);
                const wardrobe = new THREE.Mesh(wardrobeGeo, woodMaterial);
                wardrobe.position.set(room.x + 3, 2.5, room.z + 4.5);
                wardrobe.castShadow = true;
                roomMeshes.push(wardrobe);
                scene.add(wardrobe);

                // Side table
                const tableGeo = new THREE.BoxGeometry(1.5, 1.5, 1.5);
                const table = new THREE.Mesh(tableGeo, woodMaterial);
                table.position.set(room.x + 2, 1, room.z - 3);
                table.castShadow = true;
                roomMeshes.push(table);
                scene.add(table);

            } else if (room.name === 'Hall') {
                // Sofa base
                const sofaBaseGeo = new THREE.BoxGeometry(6, 1, 2.5);
                const sofaBase = new THREE.Mesh(sofaBaseGeo, fabricMaterial);
                sofaBase.position.set(room.x, 0.8, room.z - 3);
                sofaBase.castShadow = true;
                roomMeshes.push(sofaBase);
                scene.add(sofaBase);

                // Sofa back
                const sofaBackGeo = new THREE.BoxGeometry(6, 1.5, 0.5);
                const sofaBack = new THREE.Mesh(sofaBackGeo, fabricMaterial);
                sofaBack.position.set(room.x, 1.8, room.z - 4);
                sofaBack.castShadow = true;
                roomMeshes.push(sofaBack);
                scene.add(sofaBack);

                // Coffee table
                const coffeeTableGeo = new THREE.BoxGeometry(3, 0.8, 2);
                const coffeeTable = new THREE.Mesh(coffeeTableGeo, woodMaterial);
                coffeeTable.position.set(room.x, 0.6, room.z);
                coffeeTable.castShadow = true;
                roomMeshes.push(coffeeTable);
                scene.add(coffeeTable);

                // TV stand
                const tvStandGeo = new THREE.BoxGeometry(4, 1.2, 1.5);
                const tvStand = new THREE.Mesh(tvStandGeo, woodMaterial);
                tvStand.position.set(room.x, 0.8, room.z + 4.5);
                tvStand.castShadow = true;
                roomMeshes.push(tvStand);
                scene.add(tvStand);

                // TV
                const tvGeo = new THREE.BoxGeometry(3, 2, 0.2);
                const tvMaterial = new THREE.MeshStandardMaterial({ color: 0x000000, roughness: 0.2, metalness: 0.8 });
                const tv = new THREE.Mesh(tvGeo, tvMaterial);
                tv.position.set(room.x, 2.5, room.z + 5);
                tv.castShadow = true;
                roomMeshes.push(tv);
                scene.add(tv);

            } else if (room.name === 'Washroom') {
                // Toilet base
                const toiletBaseGeo = new THREE.CylinderGeometry(0.6, 0.7, 0.8, 16);
                const toiletBase = new THREE.Mesh(toiletBaseGeo, whiteMaterial);
                toiletBase.position.set(room.x - 2, 0.5, room.z - 1);
                toiletBase.castShadow = true;
                roomMeshes.push(toiletBase);
                scene.add(toiletBase);

                // Toilet seat
                const toiletSeatGeo = new THREE.CylinderGeometry(0.65, 0.65, 0.1, 16);
                const toiletSeat = new THREE.Mesh(toiletSeatGeo, whiteMaterial);
                toiletSeat.position.set(room.x - 2, 0.95, room.z - 1);
                roomMeshes.push(toiletSeat);
                scene.add(toiletSeat);

                // Sink counter
                const sinkBaseGeo = new THREE.BoxGeometry(1.5, 0.8, 1);
                const sinkBase = new THREE.Mesh(sinkBaseGeo, whiteMaterial);
                sinkBase.position.set(room.x + 1.5, 1.2, room.z + 1);
                sinkBase.castShadow = true;
                roomMeshes.push(sinkBase);
                scene.add(sinkBase);

                // Sink bowl
                const sinkBowlGeo = new THREE.CylinderGeometry(0.4, 0.3, 0.3, 16);
                const sinkBowl = new THREE.Mesh(sinkBowlGeo, whiteMaterial);
                sinkBowl.position.set(room.x + 1.5, 1.7, room.z + 1);
                roomMeshes.push(sinkBowl);
                scene.add(sinkBowl);

                // Faucet
                const faucetGeo = new THREE.CylinderGeometry(0.05, 0.05, 0.5, 8);
                const faucet = new THREE.Mesh(faucetGeo, metalMaterial);
                faucet.position.set(room.x + 1.5, 2.2, room.z + 1.3);
                roomMeshes.push(faucet);
                scene.add(faucet);

                // Shower base
                const showerBaseGeo = new THREE.BoxGeometry(2, 0.1, 2);
                const showerBase = new THREE.Mesh(showerBaseGeo, whiteMaterial);
                showerBase.position.set(room.x - 1, 0.1, room.z + 1.5);
                roomMeshes.push(showerBase);
                scene.add(showerBase);

                // Shower head
                const showerHeadGeo = new THREE.SphereGeometry(0.15, 16, 16);
                const showerHead = new THREE.Mesh(showerHeadGeo, metalMaterial);
                showerHead.position.set(room.x - 1, 3.5, room.z + 2.3);
                roomMeshes.push(showerHead);
                scene.add(showerHead);

            } else if (room.name === 'Porch') {
                // Shoe rack
                const shoeRackGeo = new THREE.BoxGeometry(3, 1.5, 1);
                const shoeRack = new THREE.Mesh(shoeRackGeo, woodMaterial);
                shoeRack.position.set(room.x - 3, 0.8, room.z - 1.5);
                shoeRack.castShadow = true;
                roomMeshes.push(shoeRack);
                scene.add(shoeRack);

                // Welcome mat
                const matGeo = new THREE.BoxGeometry(2, 0.05, 1.5);
                const matMaterial = new THREE.MeshStandardMaterial({ color: 0x654321, roughness: 0.9 });
                const mat = new THREE.Mesh(matGeo, matMaterial);
                mat.position.set(room.x, 0.05, room.z);
                roomMeshes.push(mat);
                scene.add(mat);

                // Plant pot
                const potGeo = new THREE.CylinderGeometry(0.4, 0.5, 0.8, 16);
                const potMaterial = new THREE.MeshStandardMaterial({ color: 0xD2691E, roughness: 0.7 });
                const pot = new THREE.Mesh(potGeo, potMaterial);
                pot.position.set(room.x + 4, 0.5, room.z - 1.5);
                pot.castShadow = true;
                roomMeshes.push(pot);
                scene.add(pot);

                // Plant
                const plantGeo = new THREE.ConeGeometry(0.5, 1.5, 8);
                const plantMaterial = new THREE.MeshStandardMaterial({ color: 0x228B22, roughness: 0.8 });
                const plant = new THREE.Mesh(plantGeo, plantMaterial);
                plant.position.set(room.x + 4, 1.5, room.z - 1.5);
                roomMeshes.push(plant);
                scene.add(plant);
            }
        }

        function createWalls() {
            const wallMaterial = new THREE.MeshStandardMaterial({
                color: 0x3d3d52,
                roughness: 0.8,
                metalness: 0.2
            });

            // Outer walls with door gaps
            const outerWalls = [
                // Front wall (with porch entrance gap)
                { x: 7.5, z: 27, w: 15, h: 5, d: 0.3 },
                { x: 22.5, z: 27, w: 15, h: 5, d: 0.3 },

                // Back wall
                { x: 15, z: 0, w: 30, h: 5, d: 0.3 },

                // Left wall
                { x: 0, z: 13.5, w: 0.3, h: 5, d: 27 },

                // Right wall
                { x: 30, z: 13.5, w: 0.3, h: 5, d: 27 }
            ];

            outerWalls.forEach(wall => {
                const geometry = new THREE.BoxGeometry(wall.w, wall.h, wall.d);
                const mesh = new THREE.Mesh(geometry, wallMaterial);
                mesh.position.set(wall.x, 2.5, wall.z);
                mesh.castShadow = true;
                mesh.receiveShadow = true;
                outerWallMeshes.push(mesh);
                scene.add(mesh);
            });

            // Internal walls
            const internalWalls = [
                // Between Room 1 and Room 2
                { x: 13, z: 6.5, w: 0.2, h: 5, d: 13 },

                // Between Room 1 and Washroom (with door gap)
                { x: 6.5, z: 11, w: 13, h: 5, d: 0.2 },

                // Between Washroom and Room 3 (with door gap)
                { x: 3.5, z: 15.5, w: 7, h: 5, d: 0.2 },

                // Between Room 2 and Hall (with door gap)
                { x: 19.5, z: 11, w: 13, h: 5, d: 0.2 },

                // Between Hall and Room 3 (with door gap)
                { x: 11, z: 19.5, w: 0.2, h: 5, d: 13 },

                // Between Hall and Porch (with door gap)
                { x: 19.5, z: 24.5, w: 13, h: 5, d: 0.2 }
            ];

            internalWalls.forEach(wall => {
                const geometry = new THREE.BoxGeometry(wall.w, wall.h, wall.d);
                const mesh = new THREE.Mesh(geometry, wallMaterial);
                mesh.position.set(wall.x, 2.5, wall.z);
                mesh.castShadow = true;
                mesh.receiveShadow = true;
                innerWallMeshes.push(mesh);
                scene.add(mesh);
            });
        }

        function createRoof() {
            const roofMaterial = new THREE.MeshStandardMaterial({
                color: 0x8B4513,
                roughness: 0.8,
                metalness: 0.2
            });

            const roofGeometry = new THREE.BoxGeometry(30.5, 0.5, 27.5);
            roofMesh = new THREE.Mesh(roofGeometry, roofMaterial);
            roofMesh.position.set(15, 5.5, 13.5);
            roofMesh.castShadow = true;
            roofMesh.receiveShadow = true;
            scene.add(roofMesh);
        }

        function createDoors() {
            const doorMaterial = new THREE.MeshStandardMaterial({
                color: 0x8B4513,
                roughness: 0.6,
                metalness: 0.4
            });

            const handleMaterial = new THREE.MeshStandardMaterial({
                color: 0xFFD700,
                roughness: 0.3,
                metalness: 0.8
            });

            const doors = [
                // Room 1 to Hall
                { x: 10, y: 2, z: 13, w: 2, h: 4, d: 0.1, rotation: 0 },

                // Room 2 to Hall
                { x: 16, y: 2, z: 13, w: 2, h: 4, d: 0.1, rotation: 0 },

                // Washroom door
                { x: 7, y: 2, z: 18.5, w: 0.1, h: 4, d: 1.5, rotation: Math.PI / 2 },

                // Room 3 to Hall
                { x: 13, y: 2, z: 22, w: 0.1, h: 4, d: 2, rotation: Math.PI / 2 },

                // Hall to Porch
                { x: 19.5, y: 2, z: 26, w: 2.5, h: 4, d: 0.1, rotation: 0 }
            ];

            doors.forEach(door => {
                const doorGeometry = new THREE.BoxGeometry(door.w, door.h, door.d);
                const doorMesh = new THREE.Mesh(doorGeometry, doorMaterial);
                doorMesh.position.set(door.x, door.y, door.z);
                doorMesh.rotation.y = door.rotation;
                doorMesh.castShadow = true;
                doorMeshes.push(doorMesh);
                scene.add(doorMesh);

                // Add door handle
                const handleGeometry = new THREE.SphereGeometry(0.1, 16, 16);
                const handle = new THREE.Mesh(handleGeometry, handleMaterial);
                handle.position.set(door.x + 0.7, door.y, door.z);
                doorMeshes.push(handle);
                scene.add(handle);
            });
        }

        function createWindows() {
            const frameMaterial = new THREE.MeshStandardMaterial({
                color: 0x2c2c3e,
                roughness: 0.5,
                metalness: 0.5
            });

            const glassMaterial = new THREE.MeshStandardMaterial({
                color: 0x87CEEB,
                transparent: true,
                opacity: 0.3,
                roughness: 0.1,
                metalness: 0.9
            });

            const windows = [
                // Room 1 - back wall
                { x: 6.5, y: 3, z: 0.15, w: 3, h: 2, d: 0.1 },

                // Room 2 - back wall
                { x: 19.5, y: 3, z: 0.15, w: 3, h: 2, d: 0.1 },

                // Room 3 - left wall
                { x: 0.15, y: 3, z: 23, w: 0.1, h: 2, d: 3 },

                // Hall - right wall
                { x: 29.85, y: 3, z: 19.5, w: 0.1, h: 2, d: 3 },

                // Porch - front wall (side windows)
                { x: 16, y: 3, z: 26.85, w: 2, h: 2, d: 0.1 },
                { x: 23, y: 3, z: 26.85, w: 2, h: 2, d: 0.1 }
            ];

            windows.forEach(window => {
                // Window frame
                const frameGeometry = new THREE.BoxGeometry(window.w + 0.2, window.h + 0.2, window.d);
                const frame = new THREE.Mesh(frameGeometry, frameMaterial);
                frame.position.set(window.x, window.y, window.z);
                windowMeshes.push(frame);
                scene.add(frame);

                // Glass
                const glassGeometry = new THREE.BoxGeometry(window.w, window.h, window.d * 0.5);
                const glass = new THREE.Mesh(glassGeometry, glassMaterial);
                glass.position.set(window.x, window.y, window.z);
                windowMeshes.push(glass);
                scene.add(glass);
            });
        }

        function createGate() {
            // Main entrance gate at porch
            const gateMaterial = new THREE.MeshStandardMaterial({
                color: 0x654321,
                roughness: 0.7,
                metalness: 0.3
            });

            const decorMaterial = new THREE.MeshStandardMaterial({
                color: 0xFFD700,
                roughness: 0.3,
                metalness: 0.8
            });

            // Gate posts
            const postGeometry = new THREE.BoxGeometry(0.4, 6, 0.4);
            const leftPost = new THREE.Mesh(postGeometry, gateMaterial);
            leftPost.position.set(14.5, 3, 27);
            leftPost.castShadow = true;
            gateMeshes.push(leftPost);
            scene.add(leftPost);

            const rightPost = new THREE.Mesh(postGeometry, gateMaterial);
            rightPost.position.set(16.5, 3, 27);
            rightPost.castShadow = true;
            gateMeshes.push(rightPost);
            scene.add(rightPost);

            // Gate door (open position)
            const gateGeometry = new THREE.BoxGeometry(2, 4, 0.1);
            const gate = new THREE.Mesh(gateGeometry, gateMaterial);
            gate.position.set(14, 2, 27.3);
            gate.rotation.y = -Math.PI / 3;
            gate.castShadow = true;
            gateMeshes.push(gate);
            scene.add(gate);

            // Decorative top
            const topGeometry = new THREE.BoxGeometry(3, 0.3, 0.5);
            const top = new THREE.Mesh(topGeometry, decorMaterial);
            top.position.set(15.5, 5.5, 27);
            gateMeshes.push(top);
            scene.add(top);

            // Gate decorations
            for (let i = 0; i < 3; i++) {
                const decorGeometry = new THREE.SphereGeometry(0.15, 16, 16);
                const decor = new THREE.Mesh(decorGeometry, decorMaterial);
                decor.position.set(14.5 + i, 5.5, 27);
                gateMeshes.push(decor);
                scene.add(decor);
            }
        }

        function setupControls() {
            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                autoRotate = false;
                previousMouse = { x: e.clientX, y: e.clientY };
            });

            renderer.domElement.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    const deltaX = e.clientX - previousMouse.x;
                    const deltaY = e.clientY - previousMouse.y;

                    targetRotation.y += deltaX * 0.005;
                    targetRotation.x += deltaY * 0.005;
                    targetRotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, targetRotation.x));

                    previousMouse = { x: e.clientX, y: e.clientY };
                }
            });

            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });

            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                targetCameraDistance += e.deltaY * 0.05;
                targetCameraDistance = Math.max(30, Math.min(100, targetCameraDistance));
            }, { passive: false });
        }

        function focusRoom(index) {
            const room = roomData[index];
            targetRotation.y = Math.atan2(room.x - 15, room.z - 13.5);
            targetCameraDistance = 45;
            autoRotate = false;
        }

        function toggleView() {
            if (targetRotation.x > 0) {
                targetRotation.x = -0.5;
                targetCameraDistance = 70;
            } else {
                targetRotation.x = 0.5;
                targetCameraDistance = 60;
            }
        }

        function resetView() {
            targetRotation = { x: 0.5, y: 0 };
            targetCameraDistance = 60;
            autoRotate = true;
        }

        function updateCameraPosition() {
            const x = Math.sin(rotation.y) * Math.cos(rotation.x) * cameraDistance;
            const y = Math.sin(rotation.x) * cameraDistance;
            const z = Math.cos(rotation.y) * Math.cos(rotation.x) * cameraDistance;

            camera.position.set(x + 15, y + 10, z + 13.5);
            camera.lookAt(15, 0, 13.5);
        }

        function animate() {
            requestAnimationFrame(animate);

            if (autoRotate) {
                targetRotation.y += 0.003;
            }

            rotation.x += (targetRotation.x - rotation.x) * 0.1;
            rotation.y += (targetRotation.y - rotation.y) * 0.1;
            cameraDistance += (targetCameraDistance - cameraDistance) * 0.1;

            updateCameraPosition();

            // Animate only the main room boxes (not furniture)
            roomBoxes.forEach((mesh, i) => {
                mesh.rotation.y = Math.sin(Date.now() * 0.0005 + i) * 0.02;
            });

            renderer.render(scene, camera);
        }

        function onResize() {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        }

        // Toggle functions
        function toggleRooms() {
            showRooms = !showRooms;
            roomMeshes.forEach(mesh => mesh.visible = showRooms);
            updateButton('btnRooms', showRooms);
        }

        function toggleOuterWalls() {
            showOuterWalls = !showOuterWalls;
            outerWallMeshes.forEach(mesh => mesh.visible = showOuterWalls);
            updateButton('btnOuterWalls', showOuterWalls);
        }

        function toggleInnerWalls() {
            showInnerWalls = !showInnerWalls;
            innerWallMeshes.forEach(mesh => mesh.visible = showInnerWalls);
            updateButton('btnInnerWalls', showInnerWalls);
        }

        function toggleDoors() {
            showDoors = !showDoors;
            doorMeshes.forEach(mesh => mesh.visible = showDoors);
            updateButton('btnDoors', showDoors);
        }

        function toggleWindows() {
            showWindows = !showWindows;
            windowMeshes.forEach(mesh => mesh.visible = showWindows);
            updateButton('btnWindows', showWindows);
        }

        function toggleGate() {
            showGate = !showGate;
            gateMeshes.forEach(mesh => mesh.visible = showGate);
            updateButton('btnGate', showGate);
        }

        function toggleRoof() {
            showRoof = !showRoof;
            if (roofMesh) roofMesh.visible = showRoof;
            updateButton('btnRoof', showRoof);
        }

        function updateButton(btnId, isActive) {
            const btn = document.getElementById(btnId);
            if (isActive) {
                btn.classList.add('active');
                btn.textContent = '‚úÖ ' + btn.textContent.replace('‚ùå ', '').replace('‚úÖ ', '');
            } else {
                btn.classList.remove('active');
                btn.textContent = '‚ùå ' + btn.textContent.replace('‚ùå ', '').replace('‚úÖ ', '');
            }
        }

        // Enhanced Visual Features
        function addRoomLighting() {
            roomData.forEach((room, index) => {
                const pointLight = new THREE.PointLight(room.color, 0.5, 20);
                pointLight.position.set(room.x, 4, room.z);
                pointLight.castShadow = true;
                scene.add(pointLight);
            });
        }

        function initializeMinimap() {
            const minimapGrid = document.getElementById('minimapGrid');
            const scale = 0.15; // Scale factor for minimap
            
            roomData.forEach((room, index) => {
                const roomDiv = document.createElement('div');
                roomDiv.className = 'minimap-room';
                roomDiv.style.left = (room.x - room.w/2) * scale * 10 + 'px';
                roomDiv.style.top = (room.z - room.d/2) * scale * 10 + 'px';
                roomDiv.style.width = room.w * scale * 10 + 'px';
                roomDiv.style.height = room.d * scale * 10 + 'px';
                roomDiv.style.backgroundColor = '#' + room.color.toString(16).padStart(6, '0');
                roomDiv.textContent = (index + 1).toString();
                roomDiv.onclick = () => focusRoom(index);
                minimapGrid.appendChild(roomDiv);
            });
        }

        function initializeLightingControls() {
            const ambientSlider = document.getElementById('ambientSlider');
            const mainSlider = document.getElementById('mainSlider');

            ambientSlider.addEventListener('input', (e) => {
                ambientLight.intensity = e.target.value / 100;
            });

            mainSlider.addEventListener('input', (e) => {
                mainLight.intensity = e.target.value / 100;
            });
        }

        function setTimeOfDay(time) {
            currentTimeOfDay = time;
            
            // Update button states
            document.querySelectorAll('.time-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');

            const timeSettings = {
                morning: {
                    bg: new THREE.Color(0x87CEEB),
                    ambient: 0.6,
                    main: 0.7,
                    mainColor: 0xFFE4B5,
                    fog: new THREE.Color(0x87CEEB)
                },
                day: {
                    bg: new THREE.Color(0x1a1a2e),
                    ambient: 0.4,
                    main: 0.8,
                    mainColor: 0xffffff,
                    fog: new THREE.Color(0x1a1a2e)
                },
                evening: {
                    bg: new THREE.Color(0x2F1B69),
                    ambient: 0.3,
                    main: 0.5,
                    mainColor: 0xFF6347,
                    fog: new THREE.Color(0x2F1B69)
                },
                night: {
                    bg: new THREE.Color(0x0B0B1F),
                    ambient: 0.2,
                    main: 0.3,
                    mainColor: 0x4169E1,
                    fog: new THREE.Color(0x0B0B1F)
                }
            };

            const settings = timeSettings[time];
            scene.background = settings.bg;
            scene.fog.color = settings.fog;
            ambientLight.intensity = settings.ambient;
            mainLight.intensity = settings.main;
            mainLight.color.setHex(settings.mainColor);

            // Update sliders
            document.getElementById('ambientSlider').value = settings.ambient * 100;
            document.getElementById('mainSlider').value = settings.main * 100;
        }

        function showRoomInfo(roomIndex = null) {
            const roomInfo = document.getElementById('roomInfo');
            const roomTitle = document.getElementById('roomTitle');
            const roomDetails = document.getElementById('roomDetails');
            const roomArea = document.getElementById('roomArea');

            if (roomIndex !== null) {
                const room = roomData[roomIndex];
                const icons = {
                    'Room 1': 'üõèÔ∏è', 'Room 2': 'üõèÔ∏è', 'Room 3': 'üõèÔ∏è',
                    'Washroom': 'üöø', 'Hall': 'üõãÔ∏è', 'Porch': 'üö™'
                };
                
                roomTitle.textContent = `${icons[room.name]} ${room.name}`;
                roomDetails.textContent = `${room.desc} - A comfortable space designed for relaxation and daily activities.`;
                roomArea.textContent = `Area: ${room.area}`;
                roomArea.style.display = 'block';
                roomInfo.classList.add('visible');
                selectedRoom = roomIndex;
            } else {
                roomTitle.textContent = 'üè† Select a room';
                roomDetails.textContent = 'Click on a room or use the room list to explore your home';
                roomArea.style.display = 'none';
                roomInfo.classList.remove('visible');
                selectedRoom = null;
            }
        }

        function takeScreenshot() {
            const link = document.createElement('a');
            link.download = 'floor-plan-3d.png';
            link.href = renderer.domElement.toDataURL();
            link.click();
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        // Enhanced room focus with smooth animation
        function focusRoom(index) {
            const room = roomData[index];
            
            // Highlight the selected room
            roomBoxes.forEach((mesh, i) => {
                if (i === index) {
                    mesh.material.emissiveIntensity = 0.4;
                    mesh.scale.set(1.05, 1.05, 1.05);
                } else {
                    mesh.material.emissiveIntensity = 0.2;
                    mesh.scale.set(1, 1, 1);
                }
            });

            // Update camera position
            targetRotation.y = Math.atan2(room.x - 15, room.z - 13.5);
            targetCameraDistance = 35;
            autoRotate = false;

            // Show room information
            showRoomInfo(index);
        }

        // Enhanced mouse interaction
        function setupControls() {
            renderer.domElement.addEventListener('mousedown', (e) => {
                isDragging = true;
                autoRotate = false;
                previousMouse = { x: e.clientX, y: e.clientY };
            });

            renderer.domElement.addEventListener('mousemove', (e) => {
                // Update mouse position for raycasting
                mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
                mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;

                if (isDragging) {
                    const deltaX = e.clientX - previousMouse.x;
                    const deltaY = e.clientY - previousMouse.y;

                    targetRotation.y += deltaX * 0.005;
                    targetRotation.x += deltaY * 0.005;
                    targetRotation.x = Math.max(-Math.PI / 2, Math.min(Math.PI / 2, targetRotation.x));

                    previousMouse = { x: e.clientX, y: e.clientY };
                } else {
                    // Handle hover effects
                    raycaster.setFromCamera(mouse, camera);
                    const intersects = raycaster.intersectObjects(roomBoxes);
                    
                    if (intersects.length > 0) {
                        const intersectedRoom = intersects[0].object;
                        const roomIndex = roomBoxes.indexOf(intersectedRoom);
                        
                        if (hoveredRoom !== roomIndex) {
                            // Reset previous hovered room
                            if (hoveredRoom !== null && hoveredRoom !== selectedRoom) {
                                roomBoxes[hoveredRoom].material.emissiveIntensity = 0.2;
                            }
                            
                            // Highlight new hovered room
                            if (roomIndex !== selectedRoom) {
                                intersectedRoom.material.emissiveIntensity = 0.3;
                            }
                            
                            hoveredRoom = roomIndex;
                            document.body.style.cursor = 'pointer';
                        }
                    } else {
                        // Reset hover state
                        if (hoveredRoom !== null && hoveredRoom !== selectedRoom) {
                            roomBoxes[hoveredRoom].material.emissiveIntensity = 0.2;
                        }
                        hoveredRoom = null;
                        document.body.style.cursor = 'default';
                    }
                }
            });

            renderer.domElement.addEventListener('mouseup', () => {
                isDragging = false;
            });

            renderer.domElement.addEventListener('click', (e) => {
                if (!isDragging) {
                    raycaster.setFromCamera(mouse, camera);
                    const intersects = raycaster.intersectObjects(roomBoxes);
                    
                    if (intersects.length > 0) {
                        const roomIndex = roomBoxes.indexOf(intersects[0].object);
                        focusRoom(roomIndex);
                    } else {
                        // Deselect room
                        roomBoxes.forEach(mesh => {
                            mesh.material.emissiveIntensity = 0.2;
                            mesh.scale.set(1, 1, 1);
                        });
                        showRoomInfo();
                    }
                }
            });

            renderer.domElement.addEventListener('wheel', (e) => {
                e.preventDefault();
                targetCameraDistance += e.deltaY * 0.05;
                targetCameraDistance = Math.max(25, Math.min(100, targetCameraDistance));
            }, { passive: false });
        }
    </script>
</body>

</html>